REAL #PITCH
REAL #ROWS
REAL #ROW

REAL #XSTART (X @ FIRST ROW)
REAL #ZTOUCH (Z WHERE NOZZLE MAKE CONTACT) 

REAL #FLUX_X1
REAL #FLUX_X2
REAL #FLUX_Z1
REAL #FLUX_Z2


REAL #PREHEAT_X
REAL #PREHEAT_Z 

REAL #SOLDER_X1
REAL #SOLDER_X2  
REAL #SOLDER_Z1
REAL #SOLDER_Z2

REAL #RINSE_X1
REAL #RINSE_X2
REAL #RINSE_Z1
REAL #RINSE_Z2

#ROW = 0 (FIRST ROW)
#ROWS = 5 (COUNT STARTS AT 0)
(FOR 1 ROW, #ROWS = 0)
(FOR 6 ROWS, #ROWS = 5)


#XSTART = 49.50
#ZTOUCH = -63
#PITCH = 42.3418 (1.667 INCHES)

(################### SETUP ###################)

G59                 (SELECT 8UP TOOLING, OFFSETS)
G28 		        (SEEK HOME, REF.)
WHILE #ROW <= #ROWS DO

M39                 (TURN FLUX ON)

(################### PICKUP ###################)

G52 X0 Y0 Z0 A0 B0     (REZERO ALL)
G01 A0 F1080        	(LEVEL HEAD)
G01 X[#XSTART + [#ROW*#PITCH]] F5000       (MOVE X TO PICK UP PARTS)
G01 Z[#ZTOUCH] F500       (MOVE Z TO PICK UP PARTS)
M32                 (TURN VACUUM ON)
M43		       		(OPEN BLOW OFF)
G04 P0.5            (WAIT 0.5 SECONDS)
M44                 (CLOSE BLOW OFF)
G04 P0.5            (WAIT 0.5 SECONDS)
M28		    		(TURN ON VACUUM SOLENOID, SUCTION)
G04 P5.5            (WAIT 3.5 SECONDS)
G01 Z-30 F500       (MOVE UP)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 X10
G90                 (SWITCH TO ABSOLUTE COORDINATES)

(################### FLUX #1 ###################)

#FLUX_X1 = 694.50 (FLUX, DIP NARROW SIDE X @ A=60)
#FLUX_Z1 = -90.2 (FLUX, DIP NARROW SIDE Z @ A=60)
#FLUX_X2 = 694.50 (FLUX, DIP WIDE SIDE X @ A=60)
#FLUX_Z2 = -92.57 (FLUX, DIP WIDE SIDE Z @ A=60)

#FLUX_Z1 = #FLUX_Z1 -4.5
#FLUX_Z2 = #FLUX_Z2 -4.5

G01 X#FLUX_X1   F20000   (MOVE TO FLUX)
G01 A60     F1080        (TILT) 
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 90)
G04 P1.0            (WAIT 1 SECOND)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B180 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 270)
G04 P1.0            (WAIT 1.0 SECOND)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES, 360)
G01 Z-20            (MOVE UP)
G04 P1.0	    	(WAIT 1 SECOND, DRIP)
G01 A0 F500         (SET ANGLE TO 0)
(M40                (TURN FLUX OFF)
M34                 (TURN N2 ON, PB-FREE)
M16 S#PUMP1RPM      (TURN SOLDER PUMP ON, PB-FREE)
(################### PRE-HEAT #1 ###################)

#PREHEAT_X = 635 (PRE-HEAT X @ A=0)
#PREHEAT_Z = -51.90   (PRE-HEAT Z @ A=0)
#PREHEAT_Z = #PREHEAT_Z -6
G01 X#PREHEAT_X F20000     (MOVE TO PREHEAT)
G01 Z#PREHEAT_Z            (MOVE DOWN)
G04 P20.0           	(WAIT 20 SECONDS)
G01 Z0            	(MOVE UP)
G04 P1.0            	(WAIT 1 SECOND)

(################### SOLDER #1 ###################)
(NOTE COMPENSATING FOR IMPERFECT PICKUP)
#SOLDER_X1 = 1565.88 (SOLDER X @ A=45)
#SOLDER_Z1= -16.32  (SOLDER Z @ A=45)
#SOLDER_X2 = 1564.36 (SOLDER X @ A=45)
#SOLDER_Z2 = -18.34  (SOLDER Z @ A=45)

#SOLDER_Z1 = #SOLDER_Z1 -5.5
#SOLDER_Z2 = #SOLDER_Z2 -5.5


G01 A45 	F1080		(TILT 45 DEGREES)
G04 P1.0
G01 X#SOLDER_X1 F20000    (MOVE TO PB POT, NARROW SIDE)
G04 P1.0
G01 Z#SOLDER_Z1            (MOVE DOWN TOWARDS WAVE, NARROW SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 B90             (SPIN TO TIN, SIDE 2)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-12  F600      (DIP INTO SOLDER, WIDE SIDE)
G04 P2.0            (WAIT 2.0 SECONDS)
G01 B5   F600	  (SPIN +5 DEGREES, B=5)
G01 Z5 B5 F100         (BACK OUT OF WAVE)
G01 Z7 F20000       (BACK OUT OF WAVE)
G01 B-10 F20000      (SPIN -5 DEGREES, B=0)
G01 B180             (SPIN TO TIN, SIDE 3)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-12 F600      (DIP INTO SOLDER)
G04 P2.0            (WAIT 2.0 SECONDS)
G01 B5   F600	  (SPIN +5 DEGREES, B=275)
G01 Z5 B5 F100         (BACK OUT OF WAVE)
G01 Z7 F20000       (BACK OUT OF WAVE)
G01 B-10 F20000      (SPIN -5 DEGREES, B=270) 
G01 B90 F20000      (SPIN +90 DEGREES, B=0)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z0            (MOVE UP)
G01 A0       F1080
(M17                 (TURN SOLDER PUMP OFF, PB)
(M35                 (TURN N2 OFF, PB)

(################### FLUX #2 ###################)

#FLUX_X1 = 694.50 (FLUX, DIP NARROW SIDE X @ A=60)
#FLUX_Z1 = -90.2 (FLUX, DIP NARROW SIDE Z @ A=60)
#FLUX_X2 = 694.50 (FLUX, DIP WIDE SIDE X @ A=60)
#FLUX_Z2 = -92.57 (FLUX, DIP WIDE SIDE Z @ A=60)

#FLUX_Z1 = #FLUX_Z1 -4.5
#FLUX_Z2 = #FLUX_Z2 -4.5

G01 X#FLUX_X1   F20000   (MOVE TO FLUX)
G01 A60     F1080        (TILT) 
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 90)
G04 P1.0            (WAIT 1 SECOND)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B180 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 270)
G04 P1.0            (WAIT 1.0 SECOND)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES, 360)
G01 Z-20            (MOVE UP)
G04 P1.0	    	(WAIT 1 SECOND, DRIP)
G01 A0 F500         (SET ANGLE TO 0)
(M40                (TURN FLUX OFF)
M34                 (TURN N2 ON, PB-FREE)
M16 S#PUMP1RPM      (TURN SOLDER PUMP ON, PB-FREE)
(################### PRE-HEAT #2 ###################)

#PREHEAT_X = 635 (PRE-HEAT X @ A=0)
#PREHEAT_Z = -51.90   (PRE-HEAT Z @ A=0)
#PREHEAT_Z = #PREHEAT_Z -6
G01 X#PREHEAT_X F20000     (MOVE TO PREHEAT)
G01 Z#PREHEAT_Z            (MOVE DOWN)
G04 P10.0           	(WAIT 10 SECONDS)
G01 Z0            	(MOVE UP)
G04 P1.0            	(WAIT 1 SECOND)

(################### SOLDER #2 ###################)
(NOTE COMPENSATING FOR IMPERFECT PICKUP)
#SOLDER_X1 = 1565.88 (SOLDER X @ A=45)
#SOLDER_Z1= -16.32  (SOLDER Z @ A=45)
#SOLDER_X2 = 1564.36 (SOLDER X @ A=45)
#SOLDER_Z2 = -18.34  (SOLDER Z @ A=45)

#SOLDER_Z1 = #SOLDER_Z1 -5.5
#SOLDER_Z2 = #SOLDER_Z2 -5.5


G01 A45 	F1080		(TILT 45 DEGREES)
G04 P1.0
G01 X#SOLDER_X1 F20000    (MOVE TO PB POT, NARROW SIDE)
G04 P1.0
G01 Z#SOLDER_Z1            (MOVE DOWN TOWARDS WAVE, NARROW SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 B90             (SPIN TO TIN, SIDE 2)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-12  F600      (DIP INTO SOLDER, WIDE SIDE)
G04 P2.0            (WAIT 2.0 SECONDS)
G01 B5   F600	  (SPIN +5 DEGREES, B=5)
G01 Z5 B5 F100         (BACK OUT OF WAVE)
G01 Z7 F20000       (BACK OUT OF WAVE)
G01 B-10 F20000      (SPIN -5 DEGREES, B=0)
G01 B180             (SPIN TO TIN, SIDE 3)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-12 F600      (DIP INTO SOLDER)
G04 P2.0            (WAIT 2.0 SECONDS)
G01 B5   F600	  (SPIN +5 DEGREES, B=275)
G01 Z5 B5 F100         (BACK OUT OF WAVE)
G01 Z7 F20000       (BACK OUT OF WAVE)
G01 B-10 F20000      (SPIN -5 DEGREES, B=270) 
G01 B90 F20000      (SPIN +90 DEGREES, B=0)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z0            (MOVE UP)
G01 A0       F1080
(M17                 (TURN SOLDER PUMP OFF, PB)
(M35                 (TURN N2 OFF, PB)

(###################### RINSE ######################)

#RINSE_X1 = 232.80   (RINSE_X @ A=60)
#RINSE_Z1 = -91.2   (RINSE_Z @ A=60)
#RINSE_X2 = 230.93   (RINSE_X @ A=60)
#RINSE_Z2 = -93.07   (RINSE_Z @ A=60)

#RINSE_Z1 = #RINSE_Z1 -4
#RINSE_Z2 = #RINSE_Z2 -4


M26                      (TURN RINSE ON)
(G01 X#RINSE_X1  F20000    (MOVE TO RINSE)
(G01 A60
(G01 Z#RINSE_Z1      (DIP NARROW SIDE IN RINSE, 0)
(G04 P0.5            (WAIT 0.5 SECONDS)
(G91                 (SWITCH TO RELAVTIVE COORDINATES)
(G01 Z+10            (MOVE UP)
(G01 B90 F20000      (SPIN 90 DEGREES)
(G90                 (SWITCH TO ABSOLUTE COORDINATES)

G01 X#RINSE_X2  F20000    (MOVE TO RINSE)
G01 A60
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z#RINSE_Z2      (DIP WIDE SIDE IN RINSE, 90)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B180 F20000      (SPIN 180 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)

(G01 X#RINSE_X1      (MOVE TO RINSE)
(G01 Z#RINSE_Z1      (DIP NARROW SIDE IN RINSE, 180)
(G04 P0.5            (WAIT 0.5 SECONDS)
(G91                 (SWITCH TO RELAVTIVE COORDINATES)
(G01 Z+10            (MOVE UP)
(G01 B90 F20000      (SPIN 90 DEGREES)
(G90                 (SWITCH TO ABSOLUTE COORDINATES)

G01 X#RINSE_X2  	(MOVE TO RINSE)
G01 Z#RINSE_Z2      (DIP WIDESIDE IN FLUX, 270)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES, 360)

G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z-10            (MOVE UP)
G04 P1.0	    	(WAIT 1 SECOND, DRIP)

G01 A0   F1080      (LEVEL HEAD, A=0)
M27                 (TURN RINSE OFF)

(################### RETURN PARTS ###################)

G01 X[#XSTART + [#ROW*#PITCH]+50]  F20000
G01 X[#XSTART + [#ROW*#PITCH]]  F500
G04 P0.5            (WAIT 0.5 SECONDS)
(G01 Z[#ZTOUCH + 0.5] F500       (PUT PARTS DOWN)
M33                 (TURN VACUUM OFF)
M29		        (TURN OFF VACUUM SOLENOID, SUCTION)
M43                 (OPEN TO ATMOSPHERE)
G04 P0.5            (WAIT 0.5 SECONDS)
(G04 P1.0            (WAIT 1.0 SECOND)
(M24                 (TURN ON AIR KNIFE)
(G04 P5.5            (WAIT 5.5 SECONDS)
(G01 Z[#ZTOUCH +0.8] F500       (MOVE UP)
(M44                 (CLOSE TO ATMOSPHERE)
(G04 P3.5           (WAIT 3.5 SECONDS)
(M25                (TURN OFF AIR KNIFE)
G01 Z0 F1000       (MOVE UP)
G04 P1.0           (WAIT 1.0 SECOND)
M01 ["REMOVE PARTS FROM VACUUM"]
G01 Z0 F2000      (MOVE UP)	
#ROW = #ROW +1
ENDWHILE
M17                 (TURN SOLDER PUMP OFF, PB)
M35                 (TURN N2 OFF, PB)
G28 		        (SEEK HOME, REF.)