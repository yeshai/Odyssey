REAL #PITCH
REAL #ROWS
REAL #ROW

REAL #XSTART (X @ FIRST ROW)
REAL #ZTOUCH (Z WHERE NOZZLE MAKE CONTACT) 

REAL #FLUX_X1
REAL #FLUX_X2
REAL #FLUX_Z1
REAL #FLUX_Z2


REAL #PREHEAT_X
REAL #PREHEAT_Z 

REAL #SOLDER_X1
REAL #SOLDER_X2  
REAL #SOLDER_Z1
REAL #SOLDER_Z2

REAL #RINSE_X1
REAL #RINSE_X2
REAL #RINSE_Z1
REAL #RINSE_Z2

#ROW = 0 (FIRST ROW)
#ROWS = 5 (COUNT STARTS AT 0)
(FOR 1 ROW, #ROWS = 0)
(FOR 6 ROWS, #ROWS = 5)

#XSTART = 46.5
#ZTOUCH = -54
#PITCH = 42.3418 (1.667 INCHES)

(################### SETUP ###################)

G59                 (SELECT 8UP TOOLING, OFFSETS)
G28 		        (SEEK HOME, REF.)
WHILE #ROW <= #ROWS DO
M32                 (TURN VACUUM ON)
M43		       		(OPEN BLOW OFF)
G04 P0.5            (WAIT 0.5 SECONDS)
M44                 (CLOSE BLOW OFF)
M39                 (TURN FLUX ON)

(################### PICKUP ###################)

G52 X0 Y0 Z0 A0 B0     (REZERO ALL)
G01 A0 F1080        	(LEVEL HEAD)
G01 X[#XSTART + [#ROW*#PITCH]] F5000       (MOVE X TO PICK UP PARTS)
G01 Z[#ZTOUCH] F500       (MOVE Z TO PICK UP PARTS)
M28		    		(TURN ON VACUUM SOLENOID, SUCTION)
G04 P5.5            (WAIT 3.5 SECONDS)
G01 Z-30 F500       (MOVE UP)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 X10
G90                 (SWITCH TO ABSOLUTE COORDINATES)

(################### FLUX #1 ###################)

#FLUX_X1 = 694.50 (FLUX, DIP NARROW SIDE X @ A=60)
#FLUX_Z1 = -87.00 (FLUX, DIP NARROW SIDE Z @ A=60)
#FLUX_X2 = 694.50 (FLUX, DIP WIDE SIDE X @ A=60)
#FLUX_Z2 = -89.60 (FLUX, DIP WIDE SIDE Z @ A=60)


G01 X#FLUX_X1   F20000   (MOVE TO FLUX)
G01 A60     F1080        (TILT) 
G01 Z#FLUX_Z1       (DIP NARROW SIDE IN FLUX, 0)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 90)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X1   F20000   (MOVE TO FLUX)
G01 Z#FLUX_Z1       (DIP NARROW SIDE IN FLUX. 180)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#FLUX_X2  	    (MOVE TO FLUX)
G01 Z#FLUX_Z2       (DIP WIDE SIDE IN FLUX, 270)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES, 360)
G01 Z-20            (MOVE UP)
G04 P1.0	    	(WAIT 1 SECOND, DRIP)
G01 A0 F500         (SET ANGLE TO 0)
(M40                (TURN FLUX OFF)
M34                 (TURN N2 ON, PB-FREE)
M16 S#PUMP1RPM      (TURN SOLDER PUMP ON, PB-FREE)
(################### PRE-HEAT #1 ###################)

#PREHEAT_X = 635 (PRE-HEAT X @ A=0)
#PREHEAT_Z = -51.90   (PRE-HEAT Z @ A=0)
G01 X#PREHEAT_X F20000     (MOVE TO PREHEAT)
G01 Z#PREHEAT_Z            (MOVE DOWN)
G04 P20.0           	(WAIT 30 SECONDS)
G01 Z0            	(MOVE UP)
G04 P1.0            	(WAIT 1 SECOND)

(################### SOLDER #1 ###################)
(NOTE COMPENSATING FOR IMPERFECT PICKUP)
#SOLDER_X1 = 1568.50 (SOLDER X @ A=45)
#SOLDER_Z1= -13.70-1  (SOLDER Z @ A=45)
#SOLDER_X2 = 1566.38 (SOLDER X @ A=45)
#SOLDER_Z2 = -15.82-1  (SOLDER Z @ A=45)



G01 A45 	F1080		(TILT 45 DEGREES)
G04 P1.0
G01 X#SOLDER_X1 F20000    (MOVE TO PB POT, NARROW SIDE)
G04 P1.0
G01 Z#SOLDER_Z1            (MOVE DOWN TOWARDS WAVE, NARROW SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)

G01 Z-10  F600      (DIP INTO SOLDER, NARROW SIDE)
G04 P2.0            (WAIT 1.0 SECOND)
G01 B5   F600	  (SPIN +5 DEGREES, B=5)
G01 Z5 F100         (BACK OUT OF WAVE)
G01 Z5 F20000       (BACK OUT OF WAVE)
G01 B-5 F20000      (SPIN -5 DEGREES, B=0) 

G01 B90             (SPIN TO TIN, SIDE 2)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-10  F600      (DIP INTO SOLDER, WIDE SIDE)
G04 P2.0            (WAIT 1.0 SECOND)
G01 B5   F600	  (SPIN +5 DEGREES, B=5)
G01 Z5 F100         (BACK OUT OF WAVE)
G01 Z5 F20000       (BACK OUT OF WAVE)
G01 B-5 F20000      (SPIN -5 DEGREES, B=0)

G01 B90             (SPIN TO TIN, SIDE 3)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X1 F20000    (MOVE TO PB POT, NARROW SIDE)
G04 P1.0
G01 Z#SOLDER_Z1            (MOVE DOWN TOWARDS WAVE, NARROW SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-10  F600      (DIP INTO SOLDER)
G04 P2.0            (WAIT 1.0 SECOND)
G01 B5   F600	  (SPIN +5 DEGREES, B=185)
G01 Z5 F100         (BACK OUT OF WAVE)
G01 Z5 F20000       (BACK OUT OF WAVE)
G01 B-5 F20000      (SPIN -5 DEGREES, B=180) 

G01 B90             (SPIN TO TIN, SIDE 4)
G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 X#SOLDER_X2 F20000    (MOVE TO PB POT, WIDE SIDE)
G04 P1.0
G01 Z#SOLDER_Z2            (MOVE DOWN TOWARDS WAVE, WIDE SIDE)
G04 P1.0
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z-10  F600      (DIP INTO SOLDER)
G04 P2.0            (WAIT 1.0 SECOND)
G01 B5   F600	  (SPIN +5 DEGREES, B=275)
G01 Z5 F100         (BACK OUT OF WAVE)
G01 Z5 F20000       (BACK OUT OF WAVE)
G01 B-5 F20000      (SPIN -5 DEGREES, B=270) 

G01 B90 F20000      (SPIN +90 DEGREES, B=0)

G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z0            (MOVE UP)
G01 A0       F1080
M17                 (TURN SOLDER PUMP OFF, PB)
M35                 (TURN N2 OFF, PB)

(###################### RINSE ######################)

#RINSE_X1 = 236.00   (RINSE_X @ A=60)
#RINSE_Z1 = -88.00   (RINSE_Z @ A=60)
#RINSE_X2 = 233.40   (RINSE_X @ A=60)
#RINSE_Z2 = -90.60   (RINSE_Z @ A=60)


M26                      (TURN RINSE ON)
G01 X#RINSE_X1  F20000    (MOVE TO RINSE)
G01 A60
G01 Z#RINSE_Z1      (DIP NARROW SIDE IN RINSE, 0)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)

G01 X#RINSE_X2  	(MOVE TO RINSE)
G01 Z#RINSE_Z2      (DIP WIDE SIDE IN RINSE, 90)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)

G01 X#RINSE_X1      (MOVE TO RINSE)
G01 Z#RINSE_Z1      (DIP NARROW SIDE IN RINSE, 180)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES)
G90                 (SWITCH TO ABSOLUTE COORDINATES)

G01 X#RINSE_X2  	(MOVE TO RINSE)
G01 Z#RINSE_Z2      (DIP WIDESIDE IN FLUX, 270)
G04 P0.5            (WAIT 0.5 SECONDS)
G91                 (SWITCH TO RELAVTIVE COORDINATES)
G01 Z+10            (MOVE UP)
G01 B90 F20000      (SPIN 90 DEGREES, 360)

G90                 (SWITCH TO ABSOLUTE COORDINATES)
G01 Z-10            (MOVE UP)
G04 P1.0	    	(WAIT 1 SECOND, DRIP)

G01 A0   F1080      (LEVEL HEAD, A=0)
M27                 (TURN RINSE OFF)

(################### RETURN PARTS ###################)

G01 X[#XSTART + [#ROW*#PITCH]+50]  F20000
G01 X[#XSTART + [#ROW*#PITCH]]  F500
G04 P0.5            (WAIT 0.5 SECONDS)
G01 Z[#ZTOUCH + 2] F500       (PUT PARTS DOWN)
M33                 (TURN VACUUM OFF)
M29		        (TURN OFF VACUUM SOLENOID, SUCTION)
M43                 (OPEN TO ATMOSPHERE)
G04 P1.5            (WAIT 1.5 SECONDS)
G01 Z[#ZTOUCH +2.5] F500       (MOVE UP)
M44                 (CLOSE TO ATMOSPHERE)
M24                 (TURN ON AIR KNIFE)
G04 P2.0            (WAIT 2.0 SECONDS)
M25                 (TURN OFF AIR KNIFE)
M43                 (OPEN TO ATMOSPHERE)
G01 Z[#ZTOUCH + 3.5] F500       (MOVE UP)
G04 P1.0            (WAIT 1.0 SECOND)
G01 Z0 F2000      (MOVE UP)	
#ROW = #ROW +1
ENDWHILE
G28 		        (SEEK HOME, REF.)